// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider      = "prisma-client"
  output        = "../src/generated/prisma"
  binaryTargets = ["native", "debian-openssl-1.1.x"]
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id              String      @id @default(uuid())
  email           String      @unique
  password        String      // Hashed with bcrypt
  name            String
  likesPrivate    Boolean     @default(false) // Hide from public like lists
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  likedQuotes     QuoteLike[]

  @@map("users")
}

model Quote {
  id        String      @id @default(uuid())
  text      String
  author    String
  category  String?
  tags      String?     // Stored as comma-separated string
  source    String?
  isPublic  Boolean     @default(true)
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt
  likes     QuoteLike[]

  @@map("quotes")
}

model QuoteLike {
  id        String   @id @default(uuid())
  userId    String
  quoteId   String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  quote     Quote    @relation(fields: [quoteId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())

  @@unique([userId, quoteId]) // A user can only like a quote once
  @@map("quote_likes")
}
